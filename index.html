<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head profile="http://www.w3.org/2006/03/hcard http://dublincore.org/documents/2008/08/04/dc-html/">
  <meta http-equiv="Content-Type" content="text/html; charset=us-ascii" />

  <title>Enrollment with Application Layer Security</title>

  
<style type="text/css">/*<![CDATA[*/
@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}

@media screen and (min-width: 1024px) {
  ul.toc, #rfc\.toc {
    position: fixed;
    bottom: 0;
    right: 0;
    right: calc(50vw - 500px);
    width: 300px;
    padding: 0 1em;
    z-index: 1;
  }
  #rfc\.toc {
    top: 16px;
  }
  ul.toc {
    top: 80px;
    overflow: auto;
  }

  body {
    padding-left: 1.5em;
    padding-right: 29em;
  }
}

body {
  font: 15px "Helvetica Neue",Helvetica,Arial,sans-serif;
  color: #333;
  font-size-adjust: 0.5;
  line-height: 130%;
  margin: 2.5em auto;
  max-width: 724px;
}

.title, .filename, h1, h2, h3, h4 {
  font-family: "Helvetica Neue",Helvetica,Arial,sans-serif;
  font-size-adjust: 0.5;
  font-weight: 500;
  color: #333;
  line-height: 100%;
  margin: 0.8em 0 0.3em;
}
.title { font-size: 36px; }
h1 { font-size: 30px; }
h2 { font-size: 24px; }
h3, h4 { font-size: 18px; }
h1 a[href], h2 a[href], h3 a[href], h4 a[href] {
  color: #333;
}

ul.toc li {
  list-style: none;
  text-indent: -2.5em;
  padding-left: 2.5em;
  padding-bottom: 5px;
  margin: 0;
}
ul.toc ul {
  margin: 0;
}
/* xml2rfc nests ul directly inside ul which messes with the style badly */
ul.toc, ul.toc>ul, ul.toc ul>ul {
  margin: 0 0 0 1.5em;
}

table {
  margin-left: 0em;
  border-collapse: collapse;
}
th {
  text-align: left;
  border-bottom: 2px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
  vertical-align: top;
}
tr:nth-child(2n+1) > td,
tr:nth-child(2n+1) > th {
  background-color: #f9f9f9;
}
td.reference {
  max-width: 200px;
  border-top: none;
  padding-right: 1em;
}
.right {
  text-align: right;
}


table.header {
  width: 100%;
}
table.header td {
  border: none;
  background-color: transparent;
  color: black;
}
.filename {
  color: rgb(119, 119, 119);
  font-size: 23px;
  font-weight: normal;
  height: auto;
  line-height: 100%;
}
#rfc\.abstract+p {
  font-size: 20px;
  font-weight: 300;
  line-height: 130%;
}

samp, tt, code, pre {
  font: 11pt consolas, monospace;
  font-size-adjust: none;
}
pre {
  background-color: #eee;
  border: 1px solid #ddd;
  overflow-x: auto;
  padding: 5px;
  margin: 5px;
}
.figure {
  font-style: italic;
  margin: 0 1.5em;
}

address {
  margin: 10px 0 0;
}
.vcard {
  font-style: normal;
}
.vcardline {
  display: block;
}
.vcardline .fn {
  font-weight: bold;
}
.vcardline .hidden {
  display: none;
}

dl {
  margin-left: 1em;
}
dl.dl-horizontal: {
  margin-left: 0;
}
dl > dt {
  float: left;
  margin-right: 1em;
}
dl.nohang > dt {
  float: none;
}
dl > dd {
  margin-bottom: .5em;
}
dl.compact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}
ul.empty {
  list-style-type: none;
}
ul.empty li {
  margin-top: .5em;
}

hr {
  border: 0;
  border-top: 1px solid #eee;
}

a {
  text-decoration: none;
}
a[href] {
  color: #2a6496;
}
a[href]:hover {
  background-color: #eee;
}

ol, ul, li, p {
  padding: 0;
  margin: 0.5em 0 0.5em 2em;
}
li, p {
  margin-left: 0;
}
address {
  font-style: normal;
}

.github-fork-ribbon-wrapper {
  display: none;
}
@media screen and (min-width: 800px) {
  /* "Fork me on GitHub" CSS ribbon based on
   * https://github.com/simonwhitaker/github-fork-ribbon-css
   */
  .github-fork-ribbon {
    position: absolute;
    padding: 2px 0;
    background-color: #a00;
    background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));
    box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);
    font: 700 12px "Helvetica Neue", Helvetica, Arial, sans-serif;

    pointer-events: auto;

    top: 38px;
    right: -45px;

    transform: rotate(45deg);
  }

  .github-fork-ribbon a[href],
  .github-fork-ribbon a[href]:hover {
    color: #fff;
    background-color: transparent;
    text-decoration: none;
    text-shadow: 0 -1px rgba(0, 0, 0, 0.5);
    text-align: center;

    width: 190px;
    line-height: 18px;

    display: inline-block;
    padding: 2px 0;

    border: 1.5px dotted #fff;
    border-color: rgba(255, 255, 255, 0.6);
  }

  .github-fork-ribbon-wrapper {
    display: block;
    width: 130px;
    height: 130px;
    position: absolute;
    overflow: hidden;
    top: 0; right: 0;
    z-index: 2;
    pointer-events: none;
  }
}
@media screen and (min-width: 1000px) {
  .github-fork-ribbon-wrapper {
    position: fixed;
  }
  /*]]>*/</style>


  <link href="#rfc.toc" rel="Contents"/>
<link href="#rfc.section.1" rel="Chapter" title="1 Introduction"/>
<link href="#rfc.section.1.1" rel="Chapter" title="1.1 Terminology"/>
<link href="#rfc.section.2" rel="Chapter" title="2 CMC protocol"/>
<link href="#rfc.section.2.1" rel="Chapter" title="2.1 Simple Enrollment"/>
<link href="#rfc.section.2.2" rel="Chapter" title="2.2 Re-enrollment"/>
<link href="#rfc.section.2.3" rel="Chapter" title="2.3 Full Enrollment"/>
<link href="#rfc.section.2.4" rel="Chapter" title="2.4 Compiling Certificate Content"/>
<link href="#rfc.section.3" rel="Chapter" title="3 Establishment of OSCOAP Input Parameters"/>
<link href="#rfc.section.3.1" rel="Chapter" title="3.1 EDHOC"/>
<link href="#rfc.section.3.2" rel="Chapter" title="3.2 ACE"/>
<link href="#rfc.section.4" rel="Chapter" title="4 Application to 6TiSCH"/>
<link href="#rfc.section.5" rel="Chapter" title="5 Application to ANIMA"/>
<link href="#rfc.section.6" rel="Chapter" title="6 Security Considerations"/>
<link href="#rfc.section.7" rel="Chapter" title="7 Privacy Considerations"/>
<link href="#rfc.section.8" rel="Chapter" title="8 IANA Considerations"/>
<link href="#rfc.section.9" rel="Chapter" title="9 Acknowledgments"/>
<link href="#rfc.references" rel="Chapter" title="10 References"/>
<link href="#rfc.references.1" rel="Chapter" title="10.1 Normative References"/>
<link href="#rfc.references.2" rel="Chapter" title="10.2 Informative References"/>
<link href="#rfc.appendix.A" rel="Chapter" title="A Examples"/>
<link href="#rfc.authors" rel="Chapter"/>


  <meta name="generator" content="xml2rfc version 2.5.2 - http://tools.ietf.org/tools/xml2rfc" />
  <link rel="schema.dct" href="http://purl.org/dc/terms/" />

  <meta name="dct.creator" content="Selander, G., Raza, S., Vucinic, M., Furuhed, M., and M. Richardson" />
  <meta name="dct.identifier" content="urn:ietf:id:draft-selander-ace-eals-latest" />
  <meta name="dct.issued" scheme="ISO8601" content="2017-3-12" />
  <meta name="dct.abstract" content="This document specifies public key certificate enrollment procedures authenticated with application-layer security protocols suitable for Internet of Things deployments. The protocols leverage existing IoT standards including Constrained Application Protocol (CoAP), Concise Binary Object Representation (CBOR) and the CBOR Object Signing and Encryption (COSE) format." />
  <meta name="description" content="This document specifies public key certificate enrollment procedures authenticated with application-layer security protocols suitable for Internet of Things deployments. The protocols leverage existing IoT standards including Constrained Application Protocol (CoAP), Concise Binary Object Representation (CBOR) and the CBOR Object Signing and Encryption (COSE) format." />

</head>

<body>

  <table class="header">
    <tbody>
    
    	<tr>
  <td class="left">ACE Working Group</td>
  <td class="right">G. Selander</td>
</tr>
<tr>
  <td class="left">Internet-Draft</td>
  <td class="right">Ericsson AB</td>
</tr>
<tr>
  <td class="left">Intended status: Standards Track</td>
  <td class="right">S. Raza</td>
</tr>
<tr>
  <td class="left">Expires: September 13, 2017</td>
  <td class="right">RISE SICS</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">M. Vucinic</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Inria</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">M. Furuhed</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Nexus</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">M. Richardson</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">Sandelman Software Works</td>
</tr>
<tr>
  <td class="left"></td>
  <td class="right">March 12, 2017</td>
</tr>

    	
    </tbody>
  </table>

  <p class="title">Enrollment with Application Layer Security<br />
  <span class="filename">draft-selander-ace-eals-latest</span></p>
  
  <h1 id="rfc.abstract">
  <a href="#rfc.abstract">Abstract</a>
</h1>
<p>This document specifies public key certificate enrollment procedures authenticated with application-layer security protocols suitable for Internet of Things deployments. The protocols leverage existing IoT standards including Constrained Application Protocol (CoAP), Concise Binary Object Representation (CBOR) and the CBOR Object Signing and Encryption (COSE) format.</p>
<h1 id="rfc.status">
  <a href="#rfc.status">Status of This Memo</a>
</h1>
<p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p>
<p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF).  Note that other groups may also distribute working documents as Internet-Drafts.  The list of current Internet-Drafts is at http://datatracker.ietf.org/drafts/current/.</p>
<p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time.  It is inappropriate to use Internet-Drafts as reference material or to cite them other than as "work in progress."</p>
<p>This Internet-Draft will expire on September 13, 2017.</p>
<h1 id="rfc.copyrightnotice">
  <a href="#rfc.copyrightnotice">Copyright Notice</a>
</h1>
<p>Copyright (c) 2017 IETF Trust and the persons identified as the document authors.  All rights reserved.</p>
<p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (http://trustee.ietf.org/license-info) in effect on the date of publication of this document.  Please review these documents carefully, as they describe your rights and restrictions with respect to this document.  Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p>

  
  <hr class="noprint" />
  <h1 class="np" id="rfc.toc"><a href="#rfc.toc">Table of Contents</a></h1>
  <ul class="toc">

  	<li>1.   <a href="#rfc.section.1">Introduction</a></li>
<ul><li>1.1.   <a href="#rfc.section.1.1">Terminology</a></li>
</ul><li>2.   <a href="#rfc.section.2">CMC protocol</a></li>
<ul><li>2.1.   <a href="#rfc.section.2.1">Simple Enrollment</a></li>
<li>2.2.   <a href="#rfc.section.2.2">Re-enrollment</a></li>
<li>2.3.   <a href="#rfc.section.2.3">Full Enrollment</a></li>
<li>2.4.   <a href="#rfc.section.2.4">Compiling Certificate Content</a></li>
</ul><li>3.   <a href="#rfc.section.3">Establishment of OSCOAP Input Parameters</a></li>
<ul><li>3.1.   <a href="#rfc.section.3.1">EDHOC</a></li>
<li>3.2.   <a href="#rfc.section.3.2">ACE</a></li>
</ul><li>4.   <a href="#rfc.section.4">Application to 6TiSCH</a></li>
<li>5.   <a href="#rfc.section.5">Application to ANIMA</a></li>
<li>6.   <a href="#rfc.section.6">Security Considerations</a></li>
<li>7.   <a href="#rfc.section.7">Privacy Considerations</a></li>
<li>8.   <a href="#rfc.section.8">IANA Considerations</a></li>
<li>9.   <a href="#rfc.section.9">Acknowledgments</a></li>
<li>10.   <a href="#rfc.references">References</a></li>
<ul><li>10.1.   <a href="#rfc.references.1">Normative References</a></li>
<li>10.2.   <a href="#rfc.references.2">Informative References</a></li>
</ul><li>Appendix A.   <a href="#rfc.appendix.A">Examples</a></li>
<li><a href="#rfc.authors">Authors' Addresses</a></li>


  </ul>

  <h1 id="rfc.section.1"><a href="#rfc.section.1">1.</a> <a href="#intro" id="intro">Introduction</a></h1>
<p id="rfc.section.1.p.1">Asymmetric cryptography with Public Key Infrastructure (PKI) is a de-facto key exchange and mutual authentication solution in the Internet. Though solutions based on PSK are still state-of-the-art in sensor networks they are not scalable to Internet-connected billions of things. Therefore, most IoT security standards support asymmetric cryptographic protocols. The greatest challenge with asymmetric cryptography and PKI is enrollment, the process of certifying keys. Enrollment is even more challenging in the IoT as things are resource-constrained and traditional enrollment techniques are not compatible with recent IoT security protocols. Without secure enrollment, PKI will not be trustworthy and in turn the cybersecurity of the entire system will be at stake even though the underlying cryptographic cipher suites are most secure.</p>
<p id="rfc.section.1.p.2">Security at the application layer provides an attractive option for protecting Internet of Things (IoT) deployments, in particular in constrained environments <a href="#RFC7228">[RFC7228]</a> and when using CoAP <a href="#RFC7252">[RFC7252]</a>; for example where transport layer security is not sufficient <a href="#I-D.hartke-core-e2e-security-reqs">[I-D.hartke-core-e2e-security-reqs]</a>, or where it is beneficial that the security protocol is independent of lower layers, such as when securing CoAP over mixed transport protocols.</p>
<p id="rfc.section.1.p.3">Application layer security protocols suitable for constrained devices are in development, including the secure communication protocol OSCOAP <a href="#I-D.ietf-core-object-security">[I-D.ietf-core-object-security]</a>. OSCOAP defines an extension to the Constrained Application Protocol (CoAP) providing encryption, integrity and replay protection end-to-end between CoAP client and server based on a shared secret. The shared secret can be established in different ways e.g. using a trusted third party such as in ACE <a href="#I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</a>, or using a key exchange protocol such as EDHOC <a href="#I-D.selander-ace-cose-ecdhe">[I-D.selander-ace-cose-ecdhe]</a>. OSCOAP and EDHOC can leverage other constrained device primitives developed in the IETF: CoAP, CBOR <a href="#RFC7049">[RFC7049]</a> and COSE <a href="#I-D.ietf-cose-msg">[I-D.ietf-cose-msg]</a>, and makes only a small additional implementation footprint.</p>
<p id="rfc.section.1.p.4">Lately, there has been a discussion in several IETF working groups about certificate enrollment protocols suitable for IoT devices, to support the use case of an IoT device joining a new network domain and establishing credentials valid in this domain. This document describes Enrollment with Application Layer Security (EALS), a certificate enrollment protocol based on CMC <a href="#RFC5272">[RFC5272]</a> and using OSCOAP as a secure channel. This document also describes how ACE and EDHOC can be used for establishing an authenticated and authorized channel.</p>
<p id="rfc.section.1.p.5">This work is inspired by the Enrollment over Secure Transport (EST) protocol <a href="#RFC7030">[RFC7030]</a>, which also is based on CMC, but EALS is secured on application layer instead of on transport layer.</p>
<h1 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1.</a> <a href="#terminology" id="terminology">Terminology</a></h1>
<p id="rfc.section.1.1.p.1">The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in <a href="#RFC2119">[RFC2119]</a>. These words may also appear in this document in lowercase, absent their normative meanings.</p>
<h1 id="rfc.section.2"><a href="#rfc.section.2">2.</a> <a href="#CMC" id="CMC">CMC protocol</a></h1>
<h1 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1.</a> <a href="#simple-enroll" id="simple-enroll">Simple Enrollment</a></h1>
<p id="rfc.section.2.1.p.1">This section describes the simple enrollment protocol, which is an embedding of the Simple PKI Request/Response protocol of CMC <a href="#RFC5272">[RFC5272]</a> in Object Secure CoAP (OSCOAP) <a href="#I-D.ietf-core-object-security">[I-D.ietf-core-object-security]</a>.</p>
<p id="rfc.section.2.1.p.2">The simple enrollment protocol is a 2-pass protocol between an EALS client (e.g. an IoT device) and an EALS server (a Certification Authority (CA)), see <a href="#fig-simple-enroll">Figure 1</a>. The protocol assumes that both EALS client and EALS server implement CoAP and the Object-Security option of CoAP (OSCOAP).</p>
<p id="rfc.section.2.1.p.3">OSCOAP assumes the existence of a shared secret between an EALS client and server.  The shared secret may be obtained by running a key agreement algorithm or by an aid of a trusted third party.  Mutual authentication and authorization occurs during this key agreement stage.  The simple enrollment protocol may also be run directly with a pre-shared key.  In that case, authentication and authorization of EALS client and server is implicit to the shared key protecting the /eals resource.</p>
<div id="rfc.figure.1"/>
<div id="fig-simple-enroll"/>
<pre>
EALS client                                          EALS server 

  |                                                       | 
  | POST /eals      (Object-Security; Payload: PKCS #10)  |  
  +------------------------------------------------------&gt;|
  |                                                       |          
  |  2.04 Changed   (Object-Security; Payload: PKCS #7)   |
  |&lt;------------------------------------------------------+
  |                                                       |       

</pre>
<p class="figure">Figure 1: The Simple Enrollment Protocol.</p>
<p id="rfc.section.2.1.p.4">The simple enrollment protocol consists of a CoAP message exchange.</p>
<p id="rfc.section.2.1.p.5">The EALS client sends a CoAP request:</p>
<p/>

<ul>
  <li>Method is POST</li>
  <li>Uri-Path is "eals"</li>
  <li>Object-Security option is present</li>
  <li>Payload is the CMC Simple PKI Request <a href="#RFC5272">[RFC5272]</a> (i.e. a PKCS #10 certification request).</li>
</ul>
<p id="rfc.section.2.1.p.7">If successful, the EALS server sends a CoAP response:</p>
<p/>

<ul>
  <li>Code is 2.04 (Changed)</li>
  <li>Content-Format is "application/pkcs7-mime" (TBD)</li>
  <li>Object-Security option is present</li>
  <li>Payload is a certs-only CMC Simple PKI Response <a href="#RFC5272">[RFC5272]</a> (i.e the issued certificate)</li>
</ul>
<p id="rfc.section.2.1.p.9">OSCOAP protects the CoAP message exchange between the endpoints over any transport and via intermediary nodes. The OSCOAP protection requires that a security context is established between client and server. The security context can be derived from a set of Input Parameters (Section 3.3 of <a href="#I-D.ietf-core-object-security">[I-D.ietf-core-object-security]</a>), including at least the following:</p>
<p/>

<ul>
  <li>Master Secret</li>
  <li>Sender ID</li>
  <li>Recipient ID</li>
</ul>
<p id="rfc.section.2.1.p.11">where the Master Secret is a uniformly random byte string, and the Sender ID and Recipient ID are byte strings identifying the endpoints. In <a href="#establish-input-parameters">Section 3</a> we give examples of how to the OSCOAP input parameters can be established.</p>
<p id="rfc.section.2.1.p.12">The server MUST verify that the Master Secret is associated to the Distinguished Name for which the client is requesting a certificate.</p>
<p id="rfc.section.2.1.p.13">Note 1: The encodings and formats used by CMC may later be updated with other equivalents more adapted to constrained environments.</p>
<h1 id="rfc.section.2.2"><a href="#rfc.section.2.2">2.2.</a> <a href="#re-enrollment" id="re-enrollment">Re-enrollment</a></h1>
<p id="rfc.section.2.2.p.1">Re-enrollment and re-keying of clients occurs using the same exchange as during the simple enrollment protocol. Re-enrollment request follows the same format as during the simple enrollment. In case of success, re-enrollment response contains certs-only CMC Simple PKI Response, as in the case of simple enrollment with content-format set to "application/pkcs7-mime".</p>
<p id="rfc.section.2.2.p.2">TBD. Requirements on parsing PKCS messages and X.509 certificates</p>
<p id="rfc.section.2.2.p.3">TBD. Error handling with CoAP error codes</p>
<p id="rfc.section.2.2.p.4">TBD. Server-side key generation</p>
<h1 id="rfc.section.2.3"><a href="#rfc.section.2.3">2.3.</a> <a href="#full-enroll" id="full-enroll">Full Enrollment</a></h1>
<p id="rfc.section.2.3.p.1">It is straightforward to extend the simple enrollment to the CMC Full PKI Request/Response protocol.</p>
<p id="rfc.section.2.3.p.2">In this case, to authorize the PKCS#10 request to the CA, it is enveloped in a CMC message and signed with a pre-installed device private key and certificate by the device itself.</p>
<p id="rfc.section.2.3.p.3">The public key in the device certificate acts as a unique identifier of the device. By trusting the CA issuing the pre-installed certificate, the enrolment CA can acknowledge the signed request. The trusted factory CA will also ensure the origin of the device.</p>
<p id="rfc.section.2.3.p.4">An alternative to authorize the PKCS#10 request to the CA, is to use a security gateway that can envelope the request in a CMC message using a certificate trusted by the CA.</p>
<p id="rfc.section.2.3.p.5">The details are FFS.</p>
<h1 id="rfc.section.2.4"><a href="#rfc.section.2.4">2.4.</a> <a href="#establish-content" id="establish-content">Compiling Certificate Content</a></h1>
<p id="rfc.section.2.4.p.1">A CA have several means of compiling certificate content during issuance. The subject Distinguished Name (DN) information for the certificate may be based on the content of the request alone.</p>
<p id="rfc.section.2.4.p.2">Alternatively, complementary data can be added to the request by the CA from an external source trusted by the CA, or taken from records of pre-registered information on end-entities that is stored in the CA system and which can be uniquely matched to the data in the request. Due to the constrained device capabilities the amount of subject DN data in a request may be very limited. The method of adding complementary data for the certificate can be a choice of the CA, assuming the source of complementary data can be provided in a trustworthy way.</p>
<p id="rfc.section.2.4.p.3">With the option to add complementary data to a certificate request, the end-entity provided data can be diminished by e.g. submitting only the public key in the PKCS#10 content. The public key can be used to match the device to pre-registered data or for retrieval of subject data from other sources.</p>
<h1 id="rfc.section.3"><a href="#rfc.section.3">3.</a> <a href="#establish-input-parameters" id="establish-input-parameters">Establishment of OSCOAP Input Parameters</a></h1>
<p id="rfc.section.3.p.1">In this section we present two application layer protocols for establishing OSCOAP input parameters (Section 3.3 of <a href="#I-D.ietf-core-object-security">[I-D.ietf-core-object-security]</a>), in particular the OSCOAP master secret.</p>
<h1 id="rfc.section.3.1"><a href="#rfc.section.3.1">3.1.</a> <a href="#sec-edhoc" id="sec-edhoc">EDHOC</a></h1>
<p id="rfc.section.3.1.p.1">EDHOC <a href="#I-D.selander-ace-cose-ecdhe">[I-D.selander-ace-cose-ecdhe]</a> is a key establishment protocol, corresponding to the handshake protocol of TLS, encoded with CBOR and using COSE that may be transported with e.g. CoAP. EDHOC provides mutual authentication of client and server and establishes a shared secret with forward secrecy which may be used as OSCOAP master secret in the CMC protocol (<a href="#CMC">Section 2</a>).</p>
<p id="rfc.section.3.1.p.2">The asymmetric keys authenticated version of EDHOC is described in section 4 of <a href="#I-D.selander-ace-cose-ecdhe">[I-D.selander-ace-cose-ecdhe]</a>, a simplified version of the protocol is shown in <a href="#fig-EDHOC">Figure 2</a>.</p>
<div id="rfc.figure.2"/>
<div id="fig-EDHOC"/>
<pre>
Party U                                                    Party V
   |                   S_U, N_U, E_U, EXT_1                   |
   +---------------------------------------------------------&gt;|
   |                                                          |
   |  S_U, S_V, N_V, E_V, AEAD(EXT_2, ID_V, Sig(V; E_U, E_V)) |
   |&lt;---------------------------------------------------------+
   |                                                          |
   |        S_V, AEAD(EXT_3, ID_U, Sig(U; E_V, E_U))          |
   +---------------------------------------------------------&gt;|
   |                                                          |


</pre>
<p class="figure">Figure 2: EDHOC with asymmetric key authentication (simplified). S = session identifer, N = nonce, E = ephemeral public key, ID = identifier, and EXT = application defined extension.</p>
<p id="rfc.section.3.1.p.3">The session identifiers S_U and S_V may be used as OSCOAP input parameters Sender ID and Recipient ID of party U, and v.v. as described in Appendix B2 of <a href="#I-D.selander-ace-cose-ecdhe">[I-D.selander-ace-cose-ecdhe]</a>.</p>
<p><a href="#fig-EDHOC-EALS">Figure 3</a> shows an example of using the EDHOC protocol to establish a mutually authenticated and authorized channel for the simple enrolment protocol. In this case the EALS server is EDHOC client (the mapping with interchanged roles is straightforward and left FFS). This setting has the following properties:</p>
<p/>

<ol>
  <li>The EALS server initiates the EDHOC protocol. This allows the EALS server to orchestrate many concurrent enrollments, and control the associated network load.</li>
  <li>The EALS client is authenticated first (EDHOC message_2). This allows the EALS server to authenticate the EALS client, and with this information to authorize the EALS client before completing the EDHOC protocol. The EALS server may in this case also relay authorizaton information about the EALS client, such as an ownership voucher, to the client in EDHOC extension EXT_3.</li>
</ol>
<div id="rfc.figure.3"/>
<div id="fig-EDHOC-EALS"/>
<pre>
 EALS                                     EALS 
client                                   server

  |                                        |                       
  |                                        |                       
  +---------------------------------------&gt;|                       
  |                                        |                       
  |             EDHOC message_1            |                       
  |&lt;---------------------------------------+                       
  |                                        |                       
  |            EDHOC message_2             |                       
  +---------------------------------------&gt;|    Third party           
  |                                        | &lt; - - - - - - - - &gt;            
  |  EDHOC message_3 (EXT_3 = Authz info)  |    authorization
  |&lt;---------------------------------------+                       
  |                                        |                        

</pre>
<p class="figure">Figure 3: EALS extension of EDHOC.</p>
<p id="rfc.section.3.1.p.6">Appendix B1 of <a href="#I-D.selander-ace-cose-ecdhe">[I-D.selander-ace-cose-ecdhe]</a> shows how to embed EDHOC in a CoAP message exchange, a similar embedding can be applied here.</p>
<p id="rfc.section.3.1.p.7">TBD Detail the protocol</p>
<h1 id="rfc.section.3.2"><a href="#rfc.section.3.2">3.2.</a> <a href="#ace" id="ace">ACE</a></h1>
<p id="rfc.section.3.2.p.1">The ACE protocol framework <a href="#I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</a> is an adaptation of OAuth 2.0 to IoT deployments. ACE describes different message flows for a Client to get authorized access to a Resource Server (RS) by leveraging an Authorization Server (AS).</p>
<p id="rfc.section.3.2.p.2">The Token Introspection flow (Section 7 of <a href="#I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</a>) allows an RS to access authorization information relating to a client provided Access Token. If the access token is valid, the RS obtains information about the access rights and a symmetric key used by the client, and also a Client Token containing the same shared key protected for the legitimate client (Section 7.4 of <a href="#I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</a>, <a href="#ACE-introspect">Figure 4</a>).</p>
<p id="rfc.section.3.2.p.3">This message flow assumes that the Client and AS, as well as the RS and AS, has or can establish a mutually authenticted secure channel such that:</p>
<p/>

<ul>
  <li>the AS can encrypt the symmetric key for the Client, and the Client can verify the Client Token is issued by the AS.</li>
  <li>The RS and AS exchange encrypted, integrity and replay protected introspection messages. In this case, the establishment of the secure channel can take place immediately before introspection, triggered by the RS receiveing the Access Token.</li>
</ul>
<div id="rfc.figure.4"/>
<div id="ACE-introspect"/>
<pre>
                     Resource       Authorization
    Client            Server           Server
       |                |                |
       |                |                |
       +---------------&gt;|                |
       |  POST          |                |
       |  Access Token  |                |
       |                +---------------&gt;|
       |                | Introspection  |
       |                |    Request     |
       |                |                |
       |                +&lt;---------------+
       |                | Introspection  |
       |                |   Response     |
       |                | + Client Token |
       |&lt;---------------+                |
       |  2.01 Created  |                |
       | + Client Token |


</pre>
<p class="figure">Figure 4: ACE Token Introspection with Client Token.</p>
<p id="rfc.section.3.2.p.5">By mapping the EALS client and server to the ACE client and resource server, respectively, this application of ACE enables the authorization of EALS client and establishment of a shared key, which can be used as master secret with OSCOAP in the CMC protocol (<a href="#CMC">Section 2</a>). In this case, the access token contains access rights to /eals, but is not bound to a particular resource server. The access token could be pre-provisioned to the client, e.g. during manufacture, and the AS would in this case represent the device manufacturer. Information about binding to resource server comes with the introspection response.</p>
<p id="rfc.section.3.2.p.6">Section 2 of <a href="#I-D.seitz-ace-oscoap-profile">[I-D.seitz-ace-oscoap-profile]</a> defines additional common header parameters for COSE_Key structure that are used to carry OSCOAP input parameters Sender and Recipient ID. The OSCOAP master secret is transported as part of the symmetric COSE_Key object. This document uses the same construct: COSE_Key object with OSCOAP input parameters present is transported as part of the introspection response and in the client token.</p>
<p id="rfc.section.3.2.p.7">For the benefit of the client authorizing the enrollment, this document defines an additional common parameter for the client token called voucher, extending the definition in Section 7.4 of <a href="#I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</a>:</p>
<pre>
voucher
    OPTIONAL. Contains authorization information about the server, 
    e.g. ownership voucher. The encoding is TBD. 
</pre>
<div id="rfc.figure.5"/>
<div id="ACE-cbor-mapping-voucher"/>
<pre>
.-------------------+----------+-----------------.
| Parameter name    | CBOR Key | Major Type      |
|-------------------+----------+-----------------|
| voucher           | TBD      | 2 (byte string) |
'-------------------+----------+-----------------'
</pre>
<p class="figure">Figure 5: CBOR mapping of parameters extending the client token.</p>
<p id="rfc.section.3.2.p.8">TBD Include Sender/Recipient ID in COSE_Key object (Client Token) as well as (v.v.) in Introspection Response</p>
<h1 id="rfc.section.4"><a href="#rfc.section.4">4.</a> <a href="#application-to-6tisch" id="application-to-6tisch">Application to 6TiSCH</a></h1>
<p id="rfc.section.4.p.1">One candidate embedding of EALS into a bootstrapping architecture is as described in <a href="#I-D.ietf-6tisch-minimal-security">[I-D.ietf-6tisch-minimal-security]</a>. The new device (a.k.a. Pledge) requests to be admitted into the network managed by the Join Registrar/Coordinator. The Pledge maps to an EALS/CoAP client, and the Join Registrar/Coordinator maps to an EALS/CoAP server.</p>
<p id="rfc.section.4.p.2">When a pledge first joins a constrained network, it typically does not have IPv6 connectivity to reach the Join Registrar/Coordinator. For that reason, pledge communicates with the Join Proxy, a one hop neighbor of the pledge.  Join Proxy statelessly relays the exchanges between the pledge and the Join Registrar/Coordinator.</p>
<p id="rfc.section.4.p.3">As in the model of <a href="#I-D.ietf-6tisch-minimal-security">[I-D.ietf-6tisch-minimal-security]</a>, the Join Proxy plays the role of a CoAP proxy.  Default CoAP proxy, however, keeps state information in order to relay the response back to the originating client, in this case the pledge. To mitigate Denial of Service attacks at the Join Proxy, <a href="#I-D.ietf-6tisch-minimal-security">[I-D.ietf-6tisch-minimal-security]</a> mandates the use of a new CoAP option, Stateless-Proxy option, that allows the Join Proxy to operate without keeping per-client state.</p>
<p id="rfc.section.4.p.4">The use of EDHOC as described in <a href="#sec-edhoc">Section 3.1</a> enables mutual authentication and authorization of Pledge and Join Registrar/Coordinator, and supports the use of the Stateless-Proxy option in order to provide the CoAP Proxy functionality described in this section.</p>
<h1 id="rfc.section.5"><a href="#rfc.section.5">5.</a> <a href="#application-to-anima" id="application-to-anima">Application to ANIMA</a></h1>
<p id="rfc.section.5.p.1">Another application of EALS is to the BRSKI <a href="#I-D.ietf-anima-bootstrapping-keyinfra">[I-D.ietf-anima-bootstrapping-keyinfra]</a> problem statement. BRSKI specifies an automated bootstrapping of a remote secure key infrastructure (BRSKI) using vendor installed X.509 certificate, in combination with a vendor authorized service on the Internet. BRSKI is referencing Enrolment over Secure Transport (EST) <a href="#RFC7030">[RFC7030]</a> to enable zero-touch joining of a device in a network domain. The same approach can be applied using EDHOC instead of EST, as is outlined in this document.</p>
<p id="rfc.section.5.p.2">The audit/ownership vouchers specified in <a href="#I-D.ietf-anima-bootstrapping-keyinfra">[I-D.ietf-anima-bootstrapping-keyinfra]</a> are carried as part of EDHOC application-defined extensions, as described in <a href="#sec-edhoc">Section 3.1</a>. Nonces of the EDHOC protocol can be used for freshness also of the authorization step.</p>
<p id="rfc.section.5.p.3">The limitations of applicability to energy-constrained devices due to credential size applies also to this document, and further work is needed to specify certificate formats relevant to constrained devices.  Having said that, one rationale for this document is a more optimized message exchange, and potentially also code footprint, which is favorable in low-power deployments.</p>
<h1 id="rfc.section.6"><a href="#rfc.section.6">6.</a> <a href="#sec-cons" id="sec-cons">Security Considerations</a></h1>
<h1 id="rfc.section.7"><a href="#rfc.section.7">7.</a> <a href="#privacy-considerations" id="privacy-considerations">Privacy Considerations</a></h1>
<h1 id="rfc.section.8"><a href="#rfc.section.8">8.</a> <a href="#iana" id="iana">IANA Considerations</a></h1>
<h1 id="rfc.section.9"><a href="#rfc.section.9">9.</a> <a href="#acknowledgments" id="acknowledgments">Acknowledgments</a></h1>
<p id="rfc.section.9.p.1">The authors wants to thank Michael Richardson and the 6tisch security design team for discussions and input contributing to this document.</p>
<h1 id="rfc.references"><a href="#rfc.references">10.</a> References</h1>
<h1 id="rfc.references.1"><a href="#rfc.references.1">10.1.</a> Normative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-ace-oauth-authz">[I-D.ietf-ace-oauth-authz]</b>
      </td>
      <td class="top"><a>Seitz, L.</a>, <a>Selander, G.</a>, <a>Wahlstroem, E.</a>, <a>Erdtman, S.</a> and <a>H. Tschofenig</a>, "<a href="http://tools.ietf.org/html/draft-ietf-ace-oauth-authz-05">Authentication and Authorization for Constrained Environments (ACE)</a>", Internet-Draft draft-ietf-ace-oauth-authz-05, February 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-core-object-security">[I-D.ietf-core-object-security]</b>
      </td>
      <td class="top"><a>Selander, G.</a>, <a>Mattsson, J.</a>, <a>Palombini, F.</a> and <a>L. Seitz</a>, "<a href="http://tools.ietf.org/html/draft-ietf-core-object-security-01">Object Security of CoAP (OSCOAP)</a>", Internet-Draft draft-ietf-core-object-security-01, December 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-cose-msg">[I-D.ietf-cose-msg]</b>
      </td>
      <td class="top"><a>Schaad, J.</a>, "<a href="http://tools.ietf.org/html/draft-ietf-cose-msg-24">CBOR Object Signing and Encryption (COSE)</a>", Internet-Draft draft-ietf-cose-msg-24, November 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.selander-ace-cose-ecdhe">[I-D.selander-ace-cose-ecdhe]</b>
      </td>
      <td class="top"><a>Selander, G.</a>, <a>Mattsson, J.</a> and <a>F. Palombini</a>, "<a href="http://tools.ietf.org/html/draft-selander-ace-cose-ecdhe-04">Ephemeral Diffie-Hellman Over COSE (EDHOC)</a>", Internet-Draft draft-selander-ace-cose-ecdhe-04, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC2119">[RFC2119]</b>
      </td>
      <td class="top"><a>Bradner, S.</a>, "<a href="http://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>", BCP 14, RFC 2119, DOI 10.17487/RFC2119, March 1997.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7049">[RFC7049]</b>
      </td>
      <td class="top"><a>Bormann, C.</a> and <a>P. Hoffman</a>, "<a href="http://tools.ietf.org/html/rfc7049">Concise Binary Object Representation (CBOR)</a>", RFC 7049, DOI 10.17487/RFC7049, October 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7252">[RFC7252]</b>
      </td>
      <td class="top"><a>Shelby, Z.</a>, <a>Hartke, K.</a> and <a>C. Bormann</a>, "<a href="http://tools.ietf.org/html/rfc7252">The Constrained Application Protocol (CoAP)</a>", RFC 7252, DOI 10.17487/RFC7252, June 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.references.2"><a href="#rfc.references.2">10.2.</a> Informative References</h1>
<table>
  <tbody>
    <tr>
      <td class="reference">
        <b id="I-D.hartke-core-e2e-security-reqs">[I-D.hartke-core-e2e-security-reqs]</b>
      </td>
      <td class="top"><a>Selander, G.</a>, <a>Palombini, F.</a> and <a>K. Hartke</a>, "<a href="http://tools.ietf.org/html/draft-hartke-core-e2e-security-reqs-02">Requirements for CoAP End-To-End Security</a>", Internet-Draft draft-hartke-core-e2e-security-reqs-02, January 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-6tisch-minimal-security">[I-D.ietf-6tisch-minimal-security]</b>
      </td>
      <td class="top"><a>Vucinic, M.</a>, <a>Simon, J.</a> and <a>K. Pister</a>, "<a href="http://tools.ietf.org/html/draft-ietf-6tisch-minimal-security-01">Minimal Security Framework for 6TiSCH</a>", Internet-Draft draft-ietf-6tisch-minimal-security-01, February 2017.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.ietf-anima-bootstrapping-keyinfra">[I-D.ietf-anima-bootstrapping-keyinfra]</b>
      </td>
      <td class="top"><a>Pritikin, M.</a>, <a>Richardson, M.</a>, <a>Behringer, M.</a>, <a>Bjarnason, S.</a> and <a>K. Watsen</a>, "<a href="http://tools.ietf.org/html/draft-ietf-anima-bootstrapping-keyinfra-04">Bootstrapping Remote Secure Key Infrastructures (BRSKI)</a>", Internet-Draft draft-ietf-anima-bootstrapping-keyinfra-04, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="I-D.seitz-ace-oscoap-profile">[I-D.seitz-ace-oscoap-profile]</b>
      </td>
      <td class="top"><a>Seitz, L.</a> and <a>F. Palombini</a>, "<a href="http://tools.ietf.org/html/draft-seitz-ace-oscoap-profile-01">OSCOAP profile of ACE</a>", Internet-Draft draft-seitz-ace-oscoap-profile-01, October 2016.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC5272">[RFC5272]</b>
      </td>
      <td class="top"><a>Schaad, J.</a> and <a>M. Myers</a>, "<a href="http://tools.ietf.org/html/rfc5272">Certificate Management over CMS (CMC)</a>", RFC 5272, DOI 10.17487/RFC5272, June 2008.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7030">[RFC7030]</b>
      </td>
      <td class="top"><a>Pritikin, M.</a>, <a>Yee, P.</a> and <a>D. Harkins</a>, "<a href="http://tools.ietf.org/html/rfc7030">Enrollment over Secure Transport</a>", RFC 7030, DOI 10.17487/RFC7030, October 2013.</td>
    </tr>
    <tr>
      <td class="reference">
        <b id="RFC7228">[RFC7228]</b>
      </td>
      <td class="top"><a>Bormann, C.</a>, <a>Ersue, M.</a> and <a>A. Keranen</a>, "<a href="http://tools.ietf.org/html/rfc7228">Terminology for Constrained-Node Networks</a>", RFC 7228, DOI 10.17487/RFC7228, May 2014.</td>
    </tr>
  </tbody>
</table>
<h1 id="rfc.appendix.A"><a href="#rfc.appendix.A">Appendix A.</a> <a href="#examples" id="examples">Examples</a></h1>
<h1 id="rfc.authors">
  <a href="#rfc.authors">Authors' Addresses</a>
</h1>
<div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Goeran Selander</span> 
	  <span class="n hidden">
		<span class="family-name">Selander</span>
	  </span>
	</span>
	<span class="org vcardline">Ericsson AB</span>
	<span class="adr">
	  <span class="vcardline">Farogatan 6</span>

	  <span class="vcardline">
		<span class="locality">Kista</span>,  
		<span class="region"></span>
		<span class="code">SE-16480 Stockholm</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:goran.selander@ericsson.com">goran.selander@ericsson.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Shahid Raza</span> 
	  <span class="n hidden">
		<span class="family-name">Raza</span>
	  </span>
	</span>
	<span class="org vcardline">RISE SICS</span>
	<span class="adr">
	  <span class="vcardline">Isafjordsgatan 22</span>

	  <span class="vcardline">
		<span class="locality">Kista</span>,  
		<span class="region"></span>
		<span class="code">SE-16440 Stockholm</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:shahid@sics.se">shahid@sics.se</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Malisa Vucinic</span> 
	  <span class="n hidden">
		<span class="family-name">Vucinic</span>
	  </span>
	</span>
	<span class="org vcardline">Inria</span>
	<span class="adr">
	  <span class="vcardline">2 Rue Simone Iff</span>

	  <span class="vcardline">
		<span class="locality">Paris</span>,  
		<span class="region"></span>
		<span class="code">75012</span>
	  </span>
	  <span class="country-name vcardline">France</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:malisa.vucinic@inria.fr">malisa.vucinic@inria.fr</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Martin Furuhed</span> 
	  <span class="n hidden">
		<span class="family-name">Furuhed</span>
	  </span>
	</span>
	<span class="org vcardline">Nexus</span>
	<span class="adr">
	  <span class="vcardline">Telefonv. 26</span>

	  <span class="vcardline">
		<span class="locality">Stockholm</span>,  
		<span class="region"></span>
		<span class="code">SE-12626</span>
	  </span>
	  <span class="country-name vcardline">Sweden</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:martin.furuhed@nexusgroup.com">martin.furuhed@nexusgroup.com</a></span>

  </address>
</div><div class="avoidbreak">
  <address class="vcard">
	<span class="vcardline">
	  <span class="fn">Michael Richardson</span> 
	  <span class="n hidden">
		<span class="family-name">Richardson</span>
	  </span>
	</span>
	<span class="org vcardline">Sandelman Software Works</span>
	<span class="adr">
	  <span class="vcardline">470 Dawson Avenue</span>

	  <span class="vcardline">
		<span class="locality">Ottawa, ON</span>,  
		<span class="region"></span>
		<span class="code">K1Z5V7</span>
	  </span>
	  <span class="country-name vcardline">Canada</span>
	</span>
	<span class="vcardline">EMail: <a href="mailto:mcr+ietf@sandelman.ca">mcr+ietf@sandelman.ca</a></span>

  </address>
</div>

  <div class="github-fork-ribbon-wrapper"><div class="github-fork-ribbon"><a href="https://github.com/EricssonResearch/EALS">Fork me on GitHub</a></div></div>
</body>
</html>
